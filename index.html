<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‡ºç£æ‰‹èªç†è§£èƒ½åŠ›æ¸¬é©—</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Microsoft JhengHei", "å¾®è»Ÿæ­£é»‘é«”", Arial, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
            overflow-x: hidden;
        }

        .exam-container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4a90e2, #357abd);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .exam-title {
            font-size: 24px;
            font-weight: bold;
        }

        .timer-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .timer {
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
        }

        .submit-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .submit-btn:hover {
            background: #ff5252;
            transform: translateY(-2px);
        }

        .start-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 70vh;
            padding: 50px;
            text-align: center;
        }

        .start-title {
            font-size: 32px;
            color: #4a90e2;
            margin-bottom: 30px;
            font-weight: bold;
        }

        .start-instructions {
            font-size: 18px;
            color: #666;
            line-height: 1.8;
            margin-bottom: 40px;
            max-width: 600px;
        }

        .start-btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 20px 40px;
            border-radius: 50px;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }

        .start-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }

        .exam-rules {
            background: #f8f9fa;
            border-left: 4px solid #4a90e2;
            padding: 20px;
            margin: 30px 0;
            border-radius: 5px;
        }

        .exam-rules h3 {
            color: #4a90e2;
            margin-bottom: 15px;
        }

        .exam-rules ul {
            list-style: none;
            padding: 0;
        }

        .exam-rules li {
            margin-bottom: 10px;
            padding-left: 20px;
            position: relative;
        }

        .exam-rules li:before {
            content: "âœ“";
            position: absolute;
            left: 0;
            color: #4CAF50;
            font-weight: bold;
        }

        .main-content {
            display: none;
            height: 75vh;
            min-height: 600px;
            flex-direction: row;
        }
        
        .video-section {
            flex: 2;
            background: #a8d8a8;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            padding: 30px;
        }

        .video-container {
            width: 100%;
            max-width: 600px;
            height: 400px;
            background: #000;
            border-radius: 15px;
            position: relative;
            overflow: hidden;
        }

        .video-player {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 10;
        }

        .video-status {
            font-size: 20px;
            margin-bottom: 15px;
            text-align: center;
        }

        .video-progress {
            width: 80%;
            height: 6px;
            background: rgba(255,255,255,0.3);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-bar {
            height: 100%;
            background: #4CAF50;
            width: 0%;
            transition: width 0.3s ease;
        }

        .countdown {
            font-size: 18px;
            font-weight: bold;
        }

        .question-section {
            flex: 1;
            background: white;
            padding: 30px;
            border-left: 3px solid #e0e0e0;
            display: flex;
            flex-direction: column;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .question-number {
            font-size: 20px;
            font-weight: bold;
            color: #4a90e2;
        }

        .question-progress {
            font-size: 14px;
            color: #666;
        }

        .question-title {
            font-size: 18px;
            margin-bottom: 25px;
            color: #333;
            line-height: 1.6;
        }

        .options {
            list-style: none;
            flex-grow: 1;
        }

        .option {
            margin-bottom: 15px;
        }

        .option label {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
            line-height: 1.4;
        }

        .option label:hover:not(.disabled) {
            background: #e3f2fd;
            border-color: #4a90e2;
            transform: translateX(5px);
        }

        .option input[type="radio"] {
            margin-right: 15px;
            transform: scale(1.2);
            accent-color: #4a90e2;
        }

        .option label.selected {
            background: #fff3cd;
            border-color: #ffc107;
            font-weight: bold;
        }

        .option label.disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background: #f5f5f5;
        }

        .option label.disabled input {
            pointer-events: none;
        }

        .navigation {
            padding: 20px 30px;
            background: #f8f9fa;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-info {
            font-size: 16px;
            font-weight: bold;
            color: #333;
        }

        .next-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s ease;
            font-weight: bold;
        }

        .next-btn:hover:not(:disabled) {
            background: #218838;
        }

        .next-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .warning-notice {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 30px;
            color: #856404;
            font-size: 14px;
            line-height: 1.5;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 30px;
            border-radius: 10px;
            width: 400px;
            text-align: center;
        }

        .modal h3 {
            margin-bottom: 20px;
            color: #333;
        }

        .modal-buttons {
            margin-top: 20px;
        }

        .modal-btn {
            margin: 0 10px;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }

        .confirm-btn {
            background: #dc3545;
            color: white;
        }

        .cancel-btn {
            background: #6c757d;
            color: white;
        }

        .phase-indicator {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }

        /* æ–°å¢ï¼šéšæ®µç‹€æ…‹é¡¯ç¤º */
        .phase-status {
            background: rgba(255,255,255,0.1);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            margin-bottom: 20px;
            font-weight: bold;
            text-align: center;
        }

        .phase-waiting {
            background: rgba(255, 152, 0, 0.8);
        }

        .phase-playing {
            background: rgba(76, 175, 80, 0.8);
        }

        .phase-answering {
            background: rgba(33, 150, 243, 0.8);
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
                height: auto;
            }
            
            .video-section {
                min-height: 350px;
            }
            
            .question-section {
                border-left: none;
                border-top: 3px solid #e0e0e0;
            }

            .start-instructions {
                font-size: 16px;
            }

            .start-btn {
                padding: 15px 30px;
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="exam-container">
        <div class="header">
            <div class="exam-title">è‡ºç£æ‰‹èªç†è§£èƒ½åŠ›æ¸¬é©—</div>
            <div class="timer-section">
                <div class="timer" id="timer">æº–å‚™é–‹å§‹</div>
                <button class="submit-btn" onclick="showSubmitModal()" style="display: none;" id="submitButton">äº¤å·</button>
            </div>
        </div>

        <!-- é–‹å§‹ç•«é¢ -->
        <div class="start-screen" id="startScreen">
            <div class="start-title">ğŸ¤Ÿ è‡ºç£æ‰‹èªç†è§£èƒ½åŠ›æ¸¬é©— ğŸ¤Ÿ</div>
            
            <div class="start-instructions">
                æ­¡è¿åƒåŠ è‡ºç£æ‰‹èªç†è§£èƒ½åŠ›æ¸¬é©—ï¼<br>
                è«‹ä»”ç´°é–±è®€ä»¥ä¸‹èªªæ˜ï¼Œæº–å‚™å¥½å¾Œé»æ“Šé–‹å§‹æŒ‰éˆ•ã€‚
            </div>

            <div class="exam-rules">
                <h3>ğŸ“‹ è€ƒè©¦è¦å‰‡</h3>
                <ul>
                    <li>è€ƒè©¦æ™‚é–“ï¼š<strong>30åˆ†é˜</strong></li>
                    <li>é¡Œç›®æ•¸é‡ï¼š<strong>4é¡Œ</strong></li>
                    <li>æ¯é¡Œå½±ç‰‡åƒ…æ’­æ”¾<strong>ä¸€æ¬¡</strong>ï¼Œç„¡æ³•æš«åœæˆ–é‡æ’­</li>
                    <li>ç„¡æ³•è¿”å›ä¸Šä¸€é¡Œï¼Œè«‹ä»”ç´°ä½œç­”</li>
                    <li>æ¯é¡Œç­”é¡Œæ™‚é–“é™åˆ¶ï¼š<strong>20ç§’</strong></li>
                    <li><strong>æº–å‚™éšæ®µç„¡æ³•é¸æ“‡ç­”æ¡ˆï¼Œå½±ç‰‡æ’­æ”¾æ™‚å¯é¸æ“‡ç­”æ¡ˆ</strong></li>
                    <li><strong>ç­”é¡Œæ™‚é–“çµæŸå¾Œæ‰å¯é€²å…¥ä¸‹ä¸€é¡Œ</strong></li>
                    <li>è€ƒè©¦çµæŸè«‹å‹™å¿…é»æ“Šã€Œäº¤å·ã€æŒ‰éˆ•</li>
                </ul>
            </div>

            <div class="start-instructions">
                <strong>âš ï¸ æ³¨æ„äº‹é …ï¼š</strong><br>
                â€¢ è«‹ç¢ºä¿ç¶²è·¯é€£ç·šç©©å®š<br>
                â€¢ å»ºè­°ä½¿ç”¨é›»è…¦æˆ–å¹³æ¿é€²è¡Œæ¸¬é©—<br>
                â€¢ è«‹åœ¨å®‰éœçš„ç’°å¢ƒä¸­å°ˆå¿ƒä½œç­”<br>
                â€¢ é–‹å§‹å¾Œç„¡æ³•æš«åœï¼Œè«‹ç¢ºèªæº–å‚™å®Œæˆ
            </div>

            <button class="start-btn" onclick="startExam()">
                ğŸš€ é–‹å§‹è€ƒè©¦
            </button>
        </div>

        <!-- è€ƒè©¦çµæŸç•«é¢ -->
        <div class="start-screen" id="endScreen" style="display: none;">
            <div class="start-title">ğŸ‰ æ¸¬é©—å®Œæˆ ğŸ‰</div>
            
            <div class="start-instructions">
                æ„Ÿè¬æ‚¨åƒåŠ è‡ºç£æ‰‹èªç†è§£èƒ½åŠ›æ¸¬é©—ï¼<br>
                æ‚¨çš„ç­”æ¡ˆå·²æˆåŠŸæäº¤è‡³ç³»çµ±ã€‚
            </div>

            <div class="exam-rules">
                <h3>ğŸ“Š æ¸¬é©—çµæœ</h3>
                <div id="examResult" style="font-size: 18px; line-height: 2;">
                    <!-- æ¸¬é©—çµæœæœƒå‹•æ…‹è¼‰å…¥ -->
                </div>
            </div>

            <div class="start-instructions">
                <strong>âœ… æ¸¬é©—å·²å®Œæˆ</strong><br>
                â€¢ æ‚¨çš„ç­”æ¡ˆå·²å®‰å…¨å„²å­˜<br>
                â€¢ çµæœå·²è‡ªå‹•å‚³é€çµ¦ç®¡ç†å“¡<br>
                â€¢ æ„Ÿè¬æ‚¨çš„åƒèˆ‡<br>
                â€¢ è«‹é—œé–‰æ­¤è¦–çª—
            </div>

            <button class="start-btn" onclick="window.close()" style="background: linear-gradient(135deg, #28a745, #20c997);">
                ğŸšª é—œé–‰è¦–çª—
            </button>
        </div>
        
        <div class="main-content" id="mainContent">
            <div class="video-section">
                <div class="video-container">
                    <video class="video-player" id="videoPlayer" preload="auto">
                        <!-- é€™è£¡æœƒå‹•æ…‹è¼‰å…¥å½±ç‰‡ -->
                    </video>
                    <div class="video-overlay" id="videoOverlay">
                        <div class="phase-indicator" id="phaseIndicator">æº–å‚™ä¸­</div>
                        <div class="video-status" id="videoStatus">å½±ç‰‡æº–å‚™ä¸­...</div>
                        <div class="video-progress">
                            <div class="progress-bar" id="progressBar"></div>
                        </div>
                        <div class="countdown" id="countdown"></div>
                    </div>
                </div>
            </div>

            <div class="question-section">
                <div class="question-header">
                    <div class="question-number" id="questionNumber">ç¬¬ 1 é¡Œ</div>
                    <div class="question-progress" id="questionProgress">è‡ºç£æ‰‹èªæ¸¬é©— ç¬¬1é¡Œ/å…±4é¡Œ</div>
                </div>

                <div class="question-title" id="questionTitle">
                    è«‹ä»”ç´°è§€çœ‹æ‰‹èªå½±ç‰‡ï¼Œç„¶å¾Œé¸æ“‡æ­£ç¢ºçš„ç­”æ¡ˆï¼š
                </div>

                <ul class="options" id="optionsList">
                    <!-- é¸é …æœƒå‹•æ…‹è¼‰å…¥ -->
                </ul>
            </div>
        </div>

        <div class="warning-notice" style="display: none;" id="warningNotice">
            <strong>âš ï¸ é‡è¦æé†’ï¼š</strong> 
            æœ¬æ¸¬é©—ç‚ºå–®å‘é€²è¡Œï¼Œç„¡æ³•è¿”å›ä¸Šä¸€é¡Œã€‚å½±ç‰‡åƒ…æ’­æ”¾ä¸€æ¬¡ï¼Œç„¡æ³•æš«åœæˆ–é‡æ’­ã€‚<strong>æº–å‚™éšæ®µç„¡æ³•é¸æ“‡ç­”æ¡ˆï¼Œå½±ç‰‡æ’­æ”¾æ™‚å¯é–‹å§‹é¸æ“‡ç­”æ¡ˆã€‚ç­”é¡Œæ™‚é–“çµæŸå¾Œæ‰èƒ½é€²å…¥ä¸‹ä¸€é¡Œã€‚</strong>è«‹ä»”ç´°è§€çœ‹ä¸¦åŠæ™‚ä½œç­”ã€‚è€ƒè©¦çµæŸæ™‚è«‹å‹™å¿…é»æ“Šã€Œäº¤å·ã€æŒ‰éˆ•ï¼Œæœªé»æ“Šå°‡ç„¡æ³•è¨˜éŒ„ç­”æ¡ˆã€‚
        </div>

        <div class="navigation" style="display: none;" id="navigation">
            <div class="nav-info" id="navInfo">ç¬¬ 1 é¡Œ / å…± 4 é¡Œ</div>
            <button class="next-btn" id="nextBtn" disabled>ä¸‹ä¸€é¡Œ</button>
        </div>
    </div>

    <!-- äº¤å·ç¢ºèªå°è©±æ¡† -->
    <div id="submitModal" class="modal">
        <div class="modal-content">
            <h3>ç¢ºèªäº¤å·</h3>
            <p>æ‚¨ç¢ºå®šè¦æäº¤ç­”æ¡ˆä¸¦çµæŸè€ƒè©¦å—ï¼Ÿ</p>
            <p style="color: #dc3545; margin-top: 10px;">æäº¤å¾Œå°‡ç„¡æ³•ä¿®æ”¹ç­”æ¡ˆ</p>
            <div class="modal-buttons">
                <button class="modal-btn cancel-btn" onclick="closeSubmitModal()">å–æ¶ˆ</button>
                <button class="modal-btn confirm-btn" onclick="submitExam()">ç¢ºèªäº¤å·</button>
            </div>
        </div>
    </div>

    <script>
        // æ¸¬é©—é…ç½®
        const examConfig = {
            totalTime: 1800,
            videoWaitTime: 3,
            answerTime: 20,
            autoNext: true
        };

        // é¡Œç›®è³‡æ–™
        const questions = [
            {
                id: 1,
                title: "å§Šå§Šæ¯å¤©ç·´ç¿’ä»€éº¼ä¸‰å°æ™‚ï¼Ÿ",
                videoType: "youtube",
                youtubeId: "n7wZYa3xSmk",
                options: ["å¯«æ›¸æ³•", "ç•«ç•«", "å”±æ­Œ", "è·³èˆ"],
                correctAnswer: 0
            },
            {
                id: 2,
                title: "çˆ¸çˆ¸å–œæ­¡å“ªä¸€ç¨®é£²æ–™ï¼Ÿ",
                videoType: "youtube",
                youtubeId: "n7wZYa3xSmk", // æ‚¨å¯ä»¥æ›¿æ›æˆå…¶ä»–å½±ç‰‡ ID
                options: ["ç‰›å¥¶", "å’–å•¡", "æ°´", "èŒ¶"],
                correctAnswer: 1
            },
            {
                id: 3,
                title: "å“¥å“¥åšä»€éº¼é‹å‹•ï¼Ÿ",
                videoType: "youtube",
                youtubeId: "n7wZYa3xSmk", // æ‚¨å¯ä»¥æ›¿æ›æˆå…¶ä»–å½±ç‰‡ ID
                options: ["é«˜çˆ¾å¤«", "æ¸¸æ³³", "é–€çƒ", "ç±ƒçƒ"],
                correctAnswer: 2
            },
            {
                id: 4,
                title: "å¼µè€å¸«ç¾åœ¨å¿ƒæƒ…å¦‚ä½•?",
                videoType: "youtube",
                youtubeId: "n7wZYa3xSmk", // æ‚¨å¯ä»¥æ›¿æ›æˆå…¶ä»–å½±ç‰‡ ID
                options: ["ç”Ÿæ°£", "é©šè¨", "å›°æ“¾", "ç–²ç´¯"],
                correctAnswer: 3
            }
        ];

        // è€ƒè©¦ç‹€æ…‹
        let currentQuestion = 0;
        let answers = {};
        let timeLeft = examConfig.totalTime;
        let questionPhase = 'waiting'; // æ–°å¢ï¼šæ›´æ˜ç¢ºçš„éšæ®µæ§åˆ¶
        let phaseTimeLeft = 0;
        let currentAnswer = null;
        let examStarted = false;
        let userIP = '';
        let timerInterval = null;
        let phaseInterval = null;
        let canSelectAnswer = false; // æ–°å¢ï¼šæ§åˆ¶æ˜¯å¦å¯ä»¥é¸æ“‡ç­”æ¡ˆ
        let canProceedNext = false; // æ–°å¢ï¼šæ§åˆ¶æ˜¯å¦å¯ä»¥é€²å…¥ä¸‹ä¸€é¡Œ

        // DOM å…ƒç´ 
        const timer = document.getElementById('timer');
        const videoPlayer = document.getElementById('videoPlayer');
        const videoOverlay = document.getElementById('videoOverlay');
        const videoStatus = document.getElementById('videoStatus');
        const progressBar = document.getElementById('progressBar');
        const countdown = document.getElementById('countdown');
        const phaseIndicator = document.getElementById('phaseIndicator');
        const questionNumber = document.getElementById('questionNumber');
        const questionProgress = document.getElementById('questionProgress');
        const questionTitle = document.getElementById('questionTitle');
        const optionsList = document.getElementById('optionsList');
        const navInfo = document.getElementById('navInfo');
        const nextBtn = document.getElementById('nextBtn');

        // å–å¾—IPä½ç½®
        async function getIPAddress() {
            try {
                const timestamp = new Date().toISOString();
                const userAgent = navigator.userAgent.substring(0, 50);
                const platform = navigator.platform;
                const language = navigator.language;
                
                userIP = `${platform}-${language}-${timestamp.substring(0, 19)}`;
                console.log('ä½¿ç”¨è€…è­˜åˆ¥ç¢¼:', userIP);
                
            } catch (error) {
                console.log('ç”Ÿæˆè­˜åˆ¥ç¢¼æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œä½¿ç”¨é è¨­å€¼');
                userIP = 'Unknown-' + new Date().getTime();
            }
        }

        window.addEventListener('load', function() {
            getIPAddress();
        });

        // é–‹å§‹è€ƒè©¦å‡½æ•¸
        function startExam() {
            console.log('é–‹å§‹è€ƒè©¦è¢«é»æ“Š');
            
            const startScreen = document.getElementById('startScreen');
            if (startScreen) {
                startScreen.style.display = 'none';
                console.log('é–‹å§‹ç•«é¢å·²éš±è—');
            }
            
            const mainContent = document.getElementById('mainContent');
            if (mainContent) {
                mainContent.style.display = 'flex';
                console.log('è€ƒè©¦å…§å®¹å·²é¡¯ç¤º');
            }
            
            const warningNotice = document.getElementById('warningNotice');
            if (warningNotice) {
                warningNotice.style.display = 'block';
            }
            
            const navigation = document.getElementById('navigation');
            if (navigation) {
                navigation.style.display = 'flex';
            }
            
            const submitButton = document.getElementById('submitButton');
            if (submitButton) {
                submitButton.style.display = 'block';
            }
            
            examStarted = true;
            console.log('æº–å‚™åˆå§‹åŒ–è€ƒè©¦');
            initExam();
        }

        // åˆå§‹åŒ–è€ƒè©¦
        function initExam() {
            displayQuestion();
            startQuestionPhase();
            updateTimer();
            
            timerInterval = setInterval(updateTimer, 1000);
            phaseInterval = setInterval(updatePhase, 1000);
        }

        // é¡¯ç¤ºç•¶å‰é¡Œç›®
        function displayQuestion() {
            const question = questions[currentQuestion];
            
            questionNumber.textContent = `ç¬¬ ${question.id} é¡Œ`;
            questionProgress.textContent = `è‡ºç£æ‰‹èªæ¸¬é©— ç¬¬${question.id}é¡Œ/å…±${questions.length}é¡Œ`;
            questionTitle.textContent = question.title;
            navInfo.textContent = `ç¬¬ ${question.id} é¡Œ / å…± ${questions.length} é¡Œ`;
            
            // æ¸…ç©ºå½±ç‰‡å®¹å™¨
            const videoContainer = document.querySelector('.video-container');
            
            // æ ¹æ“šå½±ç‰‡é¡å‹è¼‰å…¥ä¸åŒçš„æ’­æ”¾å™¨
            if (question.videoType === "youtube") {
                // è¼‰å…¥ YouTube å½±ç‰‡ - å°‡åœ¨ startVideoPhase ä¸­ä½¿ç”¨ API æ§åˆ¶
                videoContainer.innerHTML = '<div id="youtubePlayerContainer"></div>';
            } else {
                // è¼‰å…¥ä¸€èˆ¬ MP4 å½±ç‰‡
                videoContainer.innerHTML = `
                    <video class="video-player" id="videoPlayer" preload="auto">
                        <!-- é€™è£¡æœƒå‹•æ…‹è¼‰å…¥å½±ç‰‡ -->
                    </video>
                `;
                
                const videoPlayer = document.getElementById('videoPlayer');
                videoPlayer.src = '';
                videoPlayer.load();
                
                setTimeout(() => {
                    videoPlayer.src = question.videoUrl + '?t=' + new Date().getTime();
                    videoPlayer.load();
                    
                    videoPlayer.onloadeddata = function() {
                        console.log('å½±ç‰‡è¼‰å…¥æˆåŠŸ');
                    };
                    
                    videoPlayer.onerror = function() {
                        console.log('å½±ç‰‡è¼‰å…¥å¤±æ•—ï¼Œé‡è©¦ä¸­...');
                        setTimeout(() => {
                            videoPlayer.src = question.videoUrl + '?retry=' + Math.random();
                            videoPlayer.load();
                        }, 1000);
                    };
                }, 500);
            }
            
            // ä¿®æ­£ï¼šä¸€é–‹å§‹é¡¯ç¤ºç¦ç”¨çš„é¸é …
            displayOptions(question.options, true);
            nextBtn.disabled = true;
            nextBtn.textContent = currentQuestion === questions.length - 1 ? 'å®Œæˆæ¸¬é©—' : 'ä¸‹ä¸€é¡Œ';
            currentAnswer = null;
            canSelectAnswer = false; // é‡ç½®é¸æ“‡æ¬Šé™
            canProceedNext = false; // é‡ç½®é€²å…¥ä¸‹ä¸€é¡Œæ¬Šé™
        }

        // é¡¯ç¤ºé¸é …
        function displayOptions(options, disabled = false) {
            optionsList.innerHTML = '';
            
            options.forEach((option, index) => {
                const li = document.createElement('li');
                li.className = 'option';
                li.innerHTML = `
                    <label class="${disabled ? 'disabled' : ''}">
                        <input type="radio" name="answer" value="${index}" ${disabled ? 'disabled' : ''}>
                        ${index + 1}. ${option}
                    </label>
                `;
                optionsList.appendChild(li);
            });

            if (!disabled && canSelectAnswer) {
                document.querySelectorAll('input[name="answer"]').forEach(radio => {
                    radio.addEventListener('change', function() {
                        // ä¿®æ­£ï¼šå½±ç‰‡æ’­æ”¾éšæ®µå’Œç­”é¡Œéšæ®µéƒ½å¯ä»¥é¸æ“‡ç­”æ¡ˆ
                        if (canSelectAnswer && (questionPhase === 'playing' || questionPhase === 'answering')) {
                            document.querySelectorAll('.option label').forEach(label => {
                                label.classList.remove('selected');
                            });
                            this.parentElement.classList.add('selected');
                            currentAnswer = parseInt(this.value);
                            answers[currentQuestion] = currentAnswer;
                        }
                    });
                });
            }
        }

        // é–‹å§‹é¡Œç›®éšæ®µ
        function startQuestionPhase() {
            questionPhase = 'waiting';
            phaseTimeLeft = examConfig.videoWaitTime;
            videoOverlay.style.display = 'flex';
            phaseIndicator.textContent = 'æº–å‚™ä¸­';
            videoStatus.textContent = 'è«‹æº–å‚™è§€çœ‹æ‰‹èªå½±ç‰‡...';
            
            // ä¿®æ­£ï¼šæº–å‚™éšæ®µé¡¯ç¤ºç¦ç”¨çš„é¸é …
            canSelectAnswer = false;
            canProceedNext = false;
            displayOptions(questions[currentQuestion].options, true);
        }

        // æ›´æ–°éšæ®µ
        function updatePhase() {
            if (questionPhase === 'finished') {
                return;
            }
            
            if (phaseTimeLeft > 0) {
                phaseTimeLeft--;
                
                switch (questionPhase) {
                    case 'waiting':
                        countdown.textContent = `${phaseTimeLeft + 1} ç§’å¾Œé–‹å§‹æ’­æ”¾`;
                        progressBar.style.width = `${((examConfig.videoWaitTime - phaseTimeLeft) / examConfig.videoWaitTime) * 100}%`;
                        
                        if (phaseTimeLeft === 0) {
                            startVideoPhase();
                        }
                        break;
                        
                    case 'playing':
                        break;
                        
                    case 'answering':
                        countdown.textContent = `ç­”é¡Œæ™‚é–“å‰©é¤˜ï¼š${phaseTimeLeft} ç§’`;
                        progressBar.style.width = `${((examConfig.answerTime - phaseTimeLeft) / examConfig.answerTime) * 100}%`;
                        
                        if (phaseTimeLeft === 0) {
                            // ä¿®æ­£ï¼šç­”é¡Œæ™‚é–“çµæŸå¾Œæ‰èƒ½é€²å…¥ä¸‹ä¸€é¡Œ
                            finishAnsweringPhase();
                        }
                        break;
                }
            }
        }

        // é–‹å§‹å½±ç‰‡æ’­æ”¾éšæ®µ
        function startVideoPhase() {
            questionPhase = 'playing';
            phaseIndicator.textContent = 'æ’­æ”¾ä¸­';
            videoStatus.textContent = 'è«‹ä»”ç´°è§€çœ‹æ‰‹èªå…§å®¹ä¸¦é¸æ“‡ç­”æ¡ˆ';
            countdown.textContent = 'å½±ç‰‡æ’­æ”¾ä¸­...';
            
            videoOverlay.style.display = 'none';
            
            // ä¿®æ­£ï¼šå½±ç‰‡æ’­æ”¾éšæ®µå¯ä»¥é¸æ“‡ç­”æ¡ˆ
            canSelectAnswer = true;
            displayOptions(questions[currentQuestion].options, false);
            
            const question = questions[currentQuestion];
            
            if (question.videoType === "youtube") {
                // YouTube å½±ç‰‡è™•ç† - ä½¿ç”¨ YouTube IFrame API
                loadYouTubePlayer(question.youtubeId);
            } else {
                // ä¸€èˆ¬ MP4 å½±ç‰‡è™•ç†
                const videoPlayer = document.getElementById('videoPlayer');
                
                videoPlayer.oncanplay = function() {
                    videoPlayer.play().catch(e => {
                        console.log('è‡ªå‹•æ’­æ”¾å¤±æ•—ï¼Œä½†é€™æ˜¯æ­£å¸¸çš„');
                    });
                };

                if (videoPlayer.readyState >= 3) {
                    videoPlayer.play().catch(e => {
                        console.log('è‡ªå‹•æ’­æ”¾å¤±æ•—ï¼Œä½†é€™æ˜¯æ­£å¸¸çš„');
                    });
                }
                
                videoPlayer.onended = function() {
                    startAnswerPhase();
                };
                
                videoPlayer.ontimeupdate = function() {
                    if (videoPlayer.duration) {
                        const progress = (videoPlayer.currentTime / videoPlayer.duration) * 100;
                        progressBar.style.width = `${progress}%`;
                    }
                };
            }
        }

        // æ–°å¢ï¼šè¼‰å…¥ YouTube æ’­æ”¾å™¨ä¸¦ç›£è½çµæŸäº‹ä»¶
        function loadYouTubePlayer(videoId) {
            // è¼‰å…¥ YouTube IFrame API
            if (!window.YT) {
                const tag = document.createElement('script');
                tag.src = 'https://www.youtube.com/iframe_api';
                const firstScriptTag = document.getElementsByTagName('script')[0];
                firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
                
                // ç­‰å¾… API è¼‰å…¥å®Œæˆ
                window.onYouTubeIframeAPIReady = function() {
                    createYouTubePlayer(videoId);
                };
            } else {
                createYouTubePlayer(videoId);
            }
        }

        // æ–°å¢ï¼šå»ºç«‹ YouTube æ’­æ”¾å™¨
        function createYouTubePlayer(videoId) {
            const videoContainer = document.querySelector('.video-container');
            videoContainer.innerHTML = '<div id="youtubePlayer"></div>';
            
            window.ytPlayer = new YT.Player('youtubePlayer', {
                height: '100%',
                width: '100%',
                videoId: videoId,
                playerVars: {
                    'autoplay': 1,
                    'controls': 0,           // éš±è—æ§åˆ¶åˆ—
                    'disablekb': 1,          // ç¦ç”¨éµç›¤æ§åˆ¶
                    'fs': 0,                 // ç¦ç”¨å…¨è¢å¹•
                    'modestbranding': 1,     // æ¸›å°‘ YouTube å“ç‰Œæ¨™ç¤º
                    'rel': 0,                // ä¸é¡¯ç¤ºç›¸é—œå½±ç‰‡
                    'showinfo': 0,           // éš±è—å½±ç‰‡è³‡è¨Š
                    'iv_load_policy': 3,     // éš±è—å½±ç‰‡è¨»è§£
                    'cc_load_policy': 0,     // éš±è—å­—å¹•
                    'playsinline': 1,        // è¡Œå‹•è£ç½®å…§åµŒæ’­æ”¾
                    'widget_referrer': window.location.href,  // è¨­å®šä¾†æº
                    'origin': window.location.origin,         // è¨­å®šä¾†æºç¶²åŸŸ
                    'enablejsapi': 1         // å•Ÿç”¨ JavaScript API
                },
                events: {
                    'onReady': function(event) {
                        event.target.playVideo();
                        console.log('YouTube æ’­æ”¾å™¨æº–å‚™å®Œæˆ');
                    },
                    'onStateChange': function(event) {
                        console.log('YouTube æ’­æ”¾å™¨ç‹€æ…‹è®Šæ›´:', event.data);
                        
                        // ç•¶å½±ç‰‡çµæŸæ™‚ (ç‹€æ…‹ç¢¼ 0)
                        if (event.data === YT.PlayerState.ENDED) {
                            console.log('å½±ç‰‡æ’­æ”¾çµæŸï¼Œé€²å…¥ç­”é¡Œéšæ®µ');
                            // ç«‹å³éš±è—æ’­æ”¾å™¨ï¼Œé¿å…çœ‹åˆ°ç›¸é—œå½±ç‰‡
                            hideYouTubePlayer();
                            startAnswerPhase();
                        }
                        
                        // ç•¶å½±ç‰‡é–‹å§‹æ’­æ”¾æ™‚ (ç‹€æ…‹ç¢¼ 1)
                        if (event.data === YT.PlayerState.PLAYING) {
                            updateYouTubeProgress();
                        }
                        
                        // ç•¶å½±ç‰‡æš«åœæ™‚ (ç‹€æ…‹ç¢¼ 2) - å¯é¸ï¼šè‡ªå‹•ç¹¼çºŒæ’­æ”¾
                        if (event.data === YT.PlayerState.PAUSED) {
                            console.log('å½±ç‰‡è¢«æš«åœ');
                        }
                    },
                    'onError': function(event) {
                        console.error('YouTube æ’­æ”¾å™¨éŒ¯èª¤:', event.data);
                        // å¦‚æœè¼‰å…¥å¤±æ•—ï¼Œç›´æ¥é€²å…¥ç­”é¡Œéšæ®µ
                        hideYouTubePlayer();
                        startAnswerPhase();
                    }
                }
            });
        }

        // æ–°å¢ï¼šéš±è— YouTube æ’­æ”¾å™¨
        function hideYouTubePlayer() {
            const videoContainer = document.querySelector('.video-container');
            if (window.ytPlayer && typeof window.ytPlayer.destroy === 'function') {
                try {
                    window.ytPlayer.destroy();
                    console.log('YouTube æ’­æ”¾å™¨å·²éŠ·æ¯€');
                } catch (e) {
                    console.log('éŠ·æ¯€æ’­æ”¾å™¨æ™‚å‡ºç¾éŒ¯èª¤ï¼Œä½†é€™æ˜¯æ­£å¸¸çš„');
                }
            }
            // æ¸…ç©ºå®¹å™¨å…§å®¹
            videoContainer.innerHTML = '';
        }

        // æ–°å¢ï¼šæ›´æ–° YouTube å½±ç‰‡é€²åº¦æ¢
        function updateYouTubeProgress() {
            if (window.ytPlayer && typeof window.ytPlayer.getCurrentTime === 'function') {
                const updateProgress = () => {
                    if (questionPhase === 'playing') {
                        const currentTime = window.ytPlayer.getCurrentTime();
                        const duration = window.ytPlayer.getDuration();
                        
                        if (duration > 0) {
                            const progress = (currentTime / duration) * 100;
                            progressBar.style.width = `${progress}%`;
                        }
                        
                        // ç¹¼çºŒæ›´æ–°ï¼Œç›´åˆ°å½±ç‰‡çµæŸ
                        setTimeout(updateProgress, 1000);
                    }
                };
                updateProgress();
            }
        }

        // é–‹å§‹ç­”é¡Œéšæ®µ
        function startAnswerPhase() {
            questionPhase = 'answering';
            phaseTimeLeft = examConfig.answerTime;
            
            // ç¢ºä¿å½±ç‰‡è¦†è“‹å±¤é¡¯ç¤º
            videoOverlay.style.display = 'flex';
            phaseIndicator.textContent = 'ç­”é¡Œä¸­';
            videoStatus.textContent = 'è«‹é¸æ“‡æ­£ç¢ºç­”æ¡ˆ';
            
            // é‡ç½®é€²åº¦æ¢ç‚ºç­”é¡Œé€²åº¦
            progressBar.style.width = '0%';
            
            // ä¿®æ­£ï¼šç­”é¡Œéšæ®µæ‰å•Ÿç”¨é¸é …
            canSelectAnswer = true;
            displayOptions(questions[currentQuestion].options, false);
            
            // å¦‚æœä¹‹å‰æœ‰é¸éç­”æ¡ˆï¼Œæ¢å¾©é¸æ“‡ç‹€æ…‹
            if (answers[currentQuestion] !== undefined) {
                const radio = document.querySelector(`input[value="${answers[currentQuestion]}"]`);
                if (radio) {
                    radio.checked = true;
                    radio.parentElement.classList.add('selected');
                    currentAnswer = answers[currentQuestion];
                }
            }
            
            console.log('ç­”é¡Œéšæ®µé–‹å§‹ï¼Œæ™‚é–“é™åˆ¶:', examConfig.answerTime, 'ç§’');
        }

        // æ–°å¢ï¼šç­”é¡Œéšæ®µçµæŸè™•ç†
        function finishAnsweringPhase() {
            questionPhase = 'phase_finished';
            canSelectAnswer = false;
            canProceedNext = true;
            
            // ç¦ç”¨æ‰€æœ‰é¸é …
            displayOptions(questions[currentQuestion].options, true);
            
            // å¦‚æœæœ‰é¸æ“‡ç­”æ¡ˆï¼Œæ¢å¾©é¡¯ç¤ºé¸æ“‡ç‹€æ…‹ï¼ˆä½†ç¦ç”¨ï¼‰
            if (answers[currentQuestion] !== undefined) {
                const radio = document.querySelector(`input[value="${answers[currentQuestion]}"]`);
                if (radio) {
                    radio.checked = true;
                    radio.parentElement.classList.add('selected');
                }
            }
            
            // å•Ÿç”¨ä¸‹ä¸€é¡ŒæŒ‰éˆ•
            nextBtn.disabled = false;
            
            // æ›´æ–°é¡¯ç¤º
            videoOverlay.style.display = 'flex';
            phaseIndicator.textContent = 'ç­”é¡Œå®Œæˆ';
            videoStatus.textContent = 'æœ¬é¡Œç­”é¡Œæ™‚é–“å·²çµæŸï¼Œè«‹é»æ“Šä¸‹ä¸€é¡Œ';
            countdown.textContent = 'å¯ä»¥é€²å…¥ä¸‹ä¸€é¡Œäº†';
            progressBar.style.width = '100%';
            
            // å¦‚æœæ˜¯æœ€å¾Œä¸€é¡Œï¼Œæç¤ºå¯ä»¥äº¤å·
            if (currentQuestion === questions.length - 1) {
                videoStatus.textContent = 'æ‰€æœ‰é¡Œç›®å·²å®Œæˆï¼Œè«‹é»æ“Šå®Œæˆæ¸¬é©—æˆ–äº¤å·';
            }
        }

        // è‡ªå‹•é€²å…¥ä¸‹ä¸€é¡Œï¼ˆåƒ…åœ¨æ™‚é–“åˆ°ä¸”æœªæ‰‹å‹•æ“ä½œæ™‚ä½¿ç”¨ï¼‰
        function autoNextQuestion() {
            if (questionPhase === 'finished') {
                return;
            }
            
            if (currentQuestion < questions.length - 1) {
                nextQuestion();
            } else {
                finishExam();
            }
        }

        // ä¸‹ä¸€é¡Œ
        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                displayQuestion();
                startQuestionPhase();
            } else {
                finishExam();
            }
        }

        // å®Œæˆè€ƒè©¦
        function finishExam() {
            if (questionPhase === 'finished') {
                return;
            }
            
            questionPhase = 'finished';
            showSubmitModal();
        }

        // æ›´æ–°ç¸½è¨ˆæ™‚å™¨
        function updateTimer() {
            if (!examStarted) return;
            
            if (timeLeft <= 0) {
                questionPhase = 'finished';
                
                stopAllTimers();
                
                const answeredCount = Object.keys(answers).length;
                let correctCount = 0;
                let answerDetails = [];
                
                for (let i = 0; i < questions.length; i++) {
                    const userAnswer = answers[i];
                    const correct = userAnswer === questions[i].correctAnswer;
                    if (correct) correctCount++;
                    
                    answerDetails.push({
                        questionId: i + 1,
                        userAnswer: userAnswer !== undefined ? userAnswer : -1,
                        correct: correct
                    });
                }
                
                const score = correctCount * 2;
                const studentName = prompt('æ™‚é–“åˆ°ï¼è«‹è¼¸å…¥æ‚¨çš„å§“åä»¥å®Œæˆæäº¤ï¼š') || 'åŒ¿å';
                
                const examData = {
                    studentName: studentName,
                    answers: [answers[0], answers[1], answers[2], answers[3]],
                    answerDetails: answerDetails,
                    correctCount: correctCount,
                    score: score,
                    timestamp: new Date().toISOString(),
                    ipAddress: userIP
                };
                
                document.getElementById('mainContent').style.display = 'none';
                document.getElementById('warningNotice').style.display = 'none';
                document.getElementById('navigation').style.display = 'none';
                showEndScreen(studentName, answeredCount, correctCount, score);
                
                fetch('https://script.google.com/macros/s/AKfycbzN3mo_Jpml8Wo-415UJnCfddrP0i_1nUzvWwaZERal6LEjDsRCNzQB85qy7WdtxgV7tg/exec', {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(examData)
                })
                .then(() => {
                    setTimeout(() => {
                        alert('â° æ™‚é–“åˆ°ï¼ç­”æ¡ˆå·²è‡ªå‹•æäº¤æˆåŠŸï¼');
                    }, 1000);
                })
                .catch(error => {
                    setTimeout(() => {
                        alert('â° æ™‚é–“åˆ°ï¼ä½†ç¶²è·¯å‚³é€å¯èƒ½å¤±æ•—ï¼Œè«‹è¯çµ¡ç®¡ç†å“¡ã€‚');
                    }, 1000);
                });
                
                return;
            }
            
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timer.textContent = `å‰©é¤˜æ™‚é–“: ${minutes}åˆ†${seconds.toString().padStart(2, '0')}ç§’`;
            
            if (timeLeft <= 60) {
                timer.style.color = '#ff6b6b';
            } else if (timeLeft <= 180) {
                timer.style.color = '#ffa500';
            }
            
            timeLeft--;
        }

        // ä¸‹ä¸€é¡ŒæŒ‰éˆ•äº‹ä»¶
        nextBtn.addEventListener('click', function() {
            // ä¿®æ­£ï¼šåªæœ‰åœ¨ç­”é¡Œéšæ®µçµæŸå¾Œæ‰èƒ½é»æ“Šä¸‹ä¸€é¡Œ
            if (canProceedNext && questionPhase === 'phase_finished') {
                if (currentQuestion < questions.length - 1) {
                    nextQuestion();
                } else {
                    showSubmitModal();
                }
            }
        });

        // é¡¯ç¤ºäº¤å·ç¢ºèªå°è©±æ¡†
        function showSubmitModal() {
            document.getElementById('submitModal').style.display = 'block';
        }

        // é—œé–‰äº¤å·ç¢ºèªå°è©±æ¡†
        function closeSubmitModal() {
            document.getElementById('submitModal').style.display = 'none';
        }

        // åœæ­¢æ‰€æœ‰è¨ˆæ™‚å™¨
        function stopAllTimers() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            if (phaseInterval) {
                clearInterval(phaseInterval);
                phaseInterval = null;
            }
            
            const timer = document.getElementById('timer');
            if (timer) {
                timer.textContent = 'æ¸¬é©—å·²çµæŸ';
                timer.style.color = '#28a745';
            }
        }

        // æäº¤è€ƒè©¦
        function submitExam() {
            if (questionPhase === 'finished') {
                return;
            }
            
            questionPhase = 'finished';
            
            stopAllTimers();
            
            const answeredCount = Object.keys(answers).length;
            let correctCount = 0;
            let answerDetails = [];
            
            for (let i = 0; i < questions.length; i++) {
                const userAnswer = answers[i];
                const correct = userAnswer === questions[i].correctAnswer;
                if (correct) correctCount++;
                
                answerDetails.push({
                    questionId: i + 1,
                    userAnswer: userAnswer !== undefined ? userAnswer : -1,
                    correct: correct
                });
            }
            
            const score = correctCount * 2;
            
            const studentName = prompt('è«‹è¼¸å…¥æ‚¨çš„å§“åï¼š') || 'åŒ¿å';
            
            const examData = {
                studentName: studentName,
                answers: [answers[0], answers[1], answers[2], answers[3]],
                answerDetails: answerDetails,
                correctCount: correctCount,
                score: score,
                timestamp: new Date().toISOString(),
                ipAddress: userIP
            };
            
            console.log('æº–å‚™å‚³é€çš„è³‡æ–™:', examData);
            
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('warningNotice').style.display = 'none';
            document.getElementById('navigation').style.display = 'none';
            document.getElementById('submitModal').style.display = 'none';
            
            showEndScreen(studentName, answeredCount, correctCount, score);
            
            fetch('https://script.google.com/macros/s/AKfycbxdEJiKRbRtFsUqU3bYgMQYRTcJRu3rvWyl3UpHnxR87mBB0622Bx88IwRj5EIMW2Dd/exec', {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(examData)
            })
            .then(() => {
                setTimeout(() => {
                    alert('âœ… ç­”æ¡ˆå·²æˆåŠŸå‚³é€åˆ°ç³»çµ±ï¼\nğŸ“Š ç®¡ç†å“¡å°‡æœƒæ”¶åˆ°æ‚¨çš„æ¸¬é©—çµæœã€‚');
                }, 1000);
            })
            .catch(error => {
                console.error('å‚³é€å¤±æ•—:', error);
                setTimeout(() => {
                    alert('âš ï¸ ç¶²è·¯å‚³é€å¯èƒ½å¤±æ•—\nè«‹è¯çµ¡ç®¡ç†å“¡ç¢ºèªè³‡æ–™æ˜¯å¦å·²æ”¶åˆ°ã€‚');
                }, 1000);
            });
            
            document.querySelector('.submit-btn').disabled = true;
            nextBtn.disabled = true;
        }

        // é¡¯ç¤ºçµæŸç•«é¢
        function showEndScreen(studentName, answeredCount, correctCount, score) {
            const endScreen = document.getElementById('endScreen');
            const examResult = document.getElementById('examResult');
            
            examResult.innerHTML = `
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0;">
                    <strong>è€ƒç”Ÿå§“åï¼š</strong>${studentName}<br>
                    <strong>å·²å›ç­”ï¼š</strong>${answeredCount}/${questions.length} é¡Œ<br>
                    <strong>æ­£ç¢ºç­”æ¡ˆï¼š</strong>${correctCount}/${questions.length} é¡Œ<br>
                    <strong>å¾—åˆ†ï¼š</strong><span style="font-size: 24px; color: #28a745; font-weight: bold;">${score} åˆ†</span><br>
                    <strong>è­˜åˆ¥ç¢¼ï¼š</strong>${userIP}
                </div>
            `;
            
            endScreen.style.display = 'flex';
        }

        // é˜²æ­¢æ„å¤–é›¢é–‹é é¢
        window.addEventListener('beforeunload', function(e) {
            if (questionPhase !== 'finished' && examStarted) {
                e.preventDefault();
                e.returnValue = 'æ‚¨ç¢ºå®šè¦é›¢é–‹è€ƒè©¦é é¢å—ï¼Ÿæœªä¿å­˜çš„ç­”æ¡ˆå°‡æœƒéºå¤±ã€‚';
            }
        });

        // é˜²æ­¢å³éµå’ŒæŸäº›å¿«æ·éµ
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
        });

        document.addEventListener('keydown', function(e) {
            if (e.key === 'F5' || e.key === 'F12' || (e.ctrlKey && (e.key === 'r' || e.key === 'R'))) {
                e.preventDefault();
            }
        });
    </script>
</body>
</html>
